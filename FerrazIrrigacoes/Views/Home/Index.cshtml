@{
    ViewBag.Title = "Ferraz Irrigações";
    var caixaId = Session["CaixaId"] as int?;
}


<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title</title>
    <link rel="stylesheet" href="path/to/styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container-info">
        <p style="font-size:20px; ">Seja Bem Vindo @Session["Usuario"]</p>
            <div class="container-caixa">
                <div class="form-login">
                    <main>
                        <section aria-labelledby="aspnetTitle">
                            <form>
                                <div class="form-group">
                                    <label for="DtAberturaCaixa">Data Abertura:</label>
                                    <input type="date" id="DtAberturaCaixa" class="form-control" />
                                </div>
                                <div class="form-group">
                                    <label for="DtFechamentoCaixa">Data fechamento:</label>
                                    <input type="date" id="DtFechamentoCaixa" class="form-control" />
                                </div>
                                <div class="form-group">
                                    <label for="txtValorCaixa">Valor:</label>
                                    <input type="number" id="valor" class="form-control" />
                                </div>
                                <div class="form-group">
                                        <button type="button" id="btnFechar" class="btn btn-secondary">Fechar caixa</button>
                                        <button type="button" id="btnAbrir" class="btn btn-primary">Abrir caixa</button>
                                </div>
                            </form>
                        </section>
                    </main>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-6">
                <div class="container-chart">
                    <h2>Gráfico dos Últimos 5 Caixas Fechados</h2>
                    <canvas id="caixaChart" width="400" height="200"></canvas>
                </div>
            </div><div class="col-6">

            </div>
        </div>

        <!-- Adicione um elemento canvas para o gráfico -->


        <script type="text/javascript">
            $(document).ready(function () {
                // Função para definir a data atual
                function setCurrentDate() {
                    var today = new Date().toISOString().split('T')[0];
                    $('#DtAberturaCaixa').val(today);
                    $('#DtFechamentoCaixa').val(today);
                }

                // Chama a função para definir a data atual
                setCurrentDate();

                $("#btnAbrir").click(function () {
                    AbrirCaixa();
                });

                $("#btnFechar").click(function () {
                    FecharCaixa();
                });

                BuscarValor(0);
            });

            function BuscarValor(produtoId) {
                $.ajax({
                    async: true,
                    type: 'GET',
                    dataType: 'JSON',
                    contentType: 'application/json; charset=utf-8',
                    data: { id: produtoId },
                    url: '/Home/BuscaSaldoCaixa',
                    success: function (response) {
                        if (response.sucesso) {
                            $("#valor").val(parseFloat(response.valor).toFixed(2));
                        } else {
                            alert(response.mensagem);
                        }
                    },
                    error: function () {
                        alert("Erro ao buscar o valor do produto.");
                    }
                });
            }

            function AbrirCaixa() {
                var valorini = parseFloat($("#valor").val());

                var caixa = {
                    TotalInicial: valorini
                };

                $.ajax({
                    async: true,
                    type: 'POST',
                    dataType: 'JSON',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(caixa),
                    url: '/Caixa/AbrirCaixa',
                    success: function () {
                        alert("Caixa aberto com sucesso!");
                        window.location.reload(true);
                    },
                    error: function () {
                        console.error("Erro ao abrir caixa");
                    }
                });
            }

            function FecharCaixa() {
                $.ajax({
                    async: true,
                    type: 'POST',
                    dataType: 'JSON',
                    contentType: 'application/json; charset=utf-8',
                    url: '/Caixa/FecharCaixa',
                    success: function () {
                        alert("Caixa fechado com sucesso!");
                        window.location.reload(true);
                    },
                    error: function () {
                        console.error("Erro ao fechar caixa");
                    }
                });
            }

        </script>
    </body>
</html>